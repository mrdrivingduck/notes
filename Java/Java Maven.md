# Java - Maven é¡¹ç›®æ„å»ºå·¥å…·

Created by : Mr Dk.

2018 / 11 / 03 15:01

Nanjing, Jiangsu, China

---

## About

*Apache Maven* æ˜¯ä¸€ä¸ªé¡¹ç›®ç®¡ç†å’Œç»¼åˆå·¥å…·ã€‚æä¾›ä¸€ä¸ª **é¡¹ç›®å¯¹è±¡æ¨¡å‹æ–‡ä»¶ (POM)** çš„æ¦‚å¿µæ¥ç®¡ç†é¡¹ç›®çš„æ„å»ºã€ç›¸å…³æ€§å’Œæ–‡æ¡£ã€‚è¿˜èƒ½å¤Ÿè‡ªåŠ¨ä¸‹è½½é¡¹ç›®ä¾èµ–åº“ã€‚

## Installation

ä» Apache official ä¸Šä¸‹è½½ Maven çš„å¯æ‰§è¡Œæ–‡ä»¶å¹¶è§£å‹ã€‚

### Windows

1. æ·»åŠ ç¯å¢ƒå˜é‡ `MAVEN_HOME` - `C:\Program Files\apache-maven-3.6.3`
2. åœ¨ç¯å¢ƒå˜é‡ `PATH` ä¸­åŠ å…¥ `%MAVEN_HOME%\bin`

### Linux

```bash
vim /etc/profile
```

```
export MAVEN_HOME=/opt/module/apache-maven-3.3.9
export MAVEN_REPO=/opt/module/apache-maven-3.3.9/m2/repository
export PATH=$PATH:$MAVEN_HOME/bin
```

```bash
source /etc/profile
```

æ£€æµ‹æ˜¯å¦æˆåŠŸ:

```console
$ mvn -version
Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)
Maven home: C:\Program Files\apache-maven-3.6.3
Java version: 1.8.0_231, vendor: Oracle Corporation, runtime: C:\Program Files\Java\jre1.8.0_231
Default locale: zh_CN, platform encoding: GBK
OS name: "windows 10", version: "10.0", arch: "amd64", family: "windows"
```

## Configuration

Maven é»˜è®¤ä» **ä¸­å¤®å­˜å‚¨åº“** (`http://repo1.maven.org/maven2/`) è‡ªåŠ¨ä¸‹è½½ä¾èµ–èµ„æºã€‚ç”±äºå›½å†…çš„ç½‘ç»œç¯å¢ƒé—®é¢˜ï¼Œå¯ä»¥ä¿®æ”¹ Maven çš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å›½å†…é•œåƒï¼Œä»è€ŒåŠ å¿«ä¸‹è½½é€Ÿåº¦ã€‚å®˜æ–¹æ–‡æ¡£æ•™ç¨‹ï¼š[Apache Maven - Guide to Mirror Settings](http://maven.apache.org/guides/mini/guide-mirror-settings.html)ã€‚

é¦–å…ˆæ‰¾åˆ° Maven çš„é…ç½®æ–‡ä»¶ï¼š

* Windows ä¸‹ - `${user.home}/.m2/settings.xml` 
* Linux ä¸‹ - `maven/conf/setting.xml` (ä¼¼ä¹ Windows ä¹Ÿ OKï¼Ÿï¼Ÿï¼Ÿ ğŸ˜§)

åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å›½å†…é•œåƒ (é˜¿é‡Œäº‘ä¸ºä¾‹):

```xml
<settings>
  <mirrors>
        
    <mirror>  
      <id>nexus-aliyun</id>  
      <name>Nexus aliyun</name>
      <url>http://maven.aliyun.com/nexus/content/groups/public</url>
      <mirrorOf>central</mirrorOf>  
    </mirror> 
        
  </mirrors>
</settings>
```

## Project

åœ¨ Eclipse ä¸­æ–°å»ºä¸€ä¸ª Maven projectï¼Œé‡Œé¢æœ‰å¾ˆå¤šä¸ªå·¥ç¨‹æ¨¡æ¿ï¼Œæ ¹æ®éœ€æ±‚é€‰æ‹© (ä¸€èˆ¬é€‰æ‹© `quickstart` å³å¯)ï¼Œå¡«å†™ `groupId`ã€`artifactId`ã€`version`ã€‚Maven é€šè¿‡è¿™ä¸‰ä¸ªå…ƒç´ å”¯ä¸€ç¡®å®šä¸€ä¸ªå·¥ç¨‹ï¼š

* `groupId` - the unique identifier of the organization or group that created the project
* `artifactId` - unique base name of the primary artifact being generated by this project 
* `groupId` å’Œ `artifactId` ä¹Ÿä¼šç»„åˆä¸ºæºä»£ç è·¯å¾„ `/src` ä¸‹çš„é»˜è®¤åŒ…å

æ ¹æ®éœ€è¦è®¾ç½® `JRE System Library`ã€‚å¦‚æœéœ€è¦å¼•å…¥ä¾èµ–ï¼š

* å®šä½åˆ°å·¥ç¨‹æ ¹ç›®å½•çš„ `pom.xml` æ–‡ä»¶ä¸­çš„ `<dependencies>` å†…
* åŠ å…¥ä¾èµ–çš„å®šä¹‰ç»„ `<dependency>`ï¼Œå…¶ä¸­åŒ…æ‹¬ä¾èµ–é¡¹ç›®çš„ `groupId`ã€`artifactId`ã€`version`ï¼Œä»¥åŠ `scope` (éƒ¨ç½²é˜¶æ®µï¼Œè‹¥ä¸åŠ åˆ™é»˜è®¤æ‰€æœ‰é˜¶æ®µ)

é…ç½®ä¿å­˜å Maven ä¼šå°†ä¾èµ–çš„ `.jar` æ–‡ä»¶ä¸‹è½½åˆ° *Maven* é»˜è®¤çš„æœ¬åœ°å­˜å‚¨åº“ä¸‹ - `${user.home}/.m2/repository/`ã€‚`.jar` æ–‡ä»¶ä¸‹è½½å®Œæ¯•åï¼Œä¼šå‡ºç°åœ¨ `Build Path` çš„ `Maven Dependencies` ä¸­ã€‚ä¹‹åç›´æ¥åœ¨ `src/` ç›®å½•ä¸‹è¿›è¡Œç¼–ç å³å¯ï¼Œä¾èµ–çš„ç±»å¯ä»¥éšæ—¶è¢« `import`ã€‚

ä¸å½“å‰å·¥ç¨‹æœ‰å…³çš„ä¿¡æ¯å…¨éƒ¨éƒ½åœ¨ `pom.xml` ä¸­ï¼ŒåŒ…æ‹¬å„å­è·¯å¾„çš„ä½œç”¨ç­‰ã€‚å³é”®å·¥ç¨‹ï¼Œç‚¹å‡» `Maven/Update Project` å¯é‡æ–°æ„å»ºå·¥ç¨‹å¹¶ä¸‹è½½ä¾èµ–ã€‚

```xml
<project>
  <dependencies>
  
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>3.8.1</version>
      <scope>test</scope>
    </dependency>
    
    <dependency>
      <groupId>io.vertx</groupId>
      <artifactId>vertx-core</artifactId>
      <version>3.5.4</version>
    </dependency>
    
  </dependencies>
</project>
```

## Command

åœ¨ cmd ä¸­ç›´æ¥è¿è¡Œå‘½ä»¤

* `mvn compile` - å°† Java æºæ–‡ä»¶ç¼–è¯‘ä¸º `.class` æ–‡ä»¶
* `mvn test` - æµ‹è¯•ï¼Œå¹¶ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
* `mvn clean` - å°†ä»¥å‰ç¼–è¯‘çš„ `.class` æ–‡ä»¶åˆ é™¤
* `mvn package` - æ‰“åŒ…
* `mvn install` - æ‰“åŒ…å¹¶æ”¾å…¥ `maven` æœ¬åœ°ä»“åº“ä¸­
* ...

åœ¨ eclipse ä¸­çš„æ“ä½œæ­¥éª¤ï¼š

* é€‰æ‹© `Run As`
* é€‰æ‹© `Maven build `
* åœ¨å…¶ä¸­çš„ `Goals` ä¸­å¡«å…¥å¯¹åº”çš„å‘½ä»¤ - å¦‚ `compile`ã€`install` ç­‰

åœ¨ Visual Studio Code ä¸­çš„ *Maven for Java* æ’ä»¶çš„å¸®åŠ©ä¸‹å¯ç›´æ¥è¿è¡Œå‘½ä»¤ï¼š

![maven-cmd](../img/maven-cmd.png)

`mvn compile` å‘½ä»¤ï¼š

![maven-compile](../img/maven-compile.png)

`mvn clean` å‘½ä»¤ï¼š

![maven-clean](../img/maven-clean.png)

ç¼–è¯‘å‰ï¼Œéœ€è¦åœ¨ `pom.xml` æ–‡ä»¶ä¸­æŒ‡å®šç¼–è¯‘æ‰€éœ€çš„ JDK ç‰ˆæœ¬å’Œç¼–ç æ ¼å¼ï¼Œä»¥åŠæŒ‡å®š `maven-compiler-plugins` çš„ç‰ˆæœ¬ `<version></version>`ã€‚

```xml
<build>
  <plugins>
    <plugin>
      <groupId>org.apache.maven.plugins</groupId>
      <artifactId>maven-compiler-plugin</artifactId>
      <version>3.6.0</version>
      <configuration>
        <source>1.8</source>
        <target>1.8</target>
        <encoding>UTF-8</encoding>
      </configuration>
    </plugin>
  </plugins>
</build>
```

---

## Summary

å…¶å®ä»¥å‰ç»å¸¸çœ‹åˆ° *Maven* è¿™ä¸ªä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯åœ¨ç”¨åˆ«äººçš„ä»£ç çš„æ—¶å€™ä½†æ˜¯æ²¡æœ‰èŠ±å¿ƒæ€ç ”ç©¶ã€‚

ä»Šå¤©å­¦ä¹  *Vert.x* æ¡†æ¶çš„æ—¶å€™ï¼Œå†™äº†ä¸€äº› demo å‡†å¤‡ä¸Šä¼ åˆ° GitHub ä¸Šï¼Œçªç„¶å‘ç°å·¥ç¨‹ç›®å½•ä¸‹ `lib/` é‡Œçš„æ–‡ä»¶æœ‰ 80 MBã€‚åŒ…æ‹¬ *Vert.x* çš„å„ç§ `.jar` æ–‡ä»¶ä»¥åŠå…¶ä¾èµ–æ–‡ä»¶ï¼Œä¼ ä¸Šå»æ—¢å½±å“é€Ÿåº¦ä¹Ÿæ²¡æœ‰å¿…è¦ã€‚æ‰€ä»¥æŠŠæ•´ä¸ªå·¥ç¨‹æ„å»ºæˆ Maven projectï¼Œè¿™æ ·ä¸å†éœ€è¦ä¸Šä¼ ä¾èµ–çš„åº“äº†ã€‚

---

